<p>
这个问题完全是属于运维上的 bug. 同时这个 bug 也很有意思所以记录一下.
这个问题出现是基于以下几点.</p>

<p>
    <ul>

        <li>GPT 默认的情况下会使用磁盘的大约前 17K 的空间用于保存 PMBR, gpt 头, 分区表.

        <li>GPT 会在磁盘的最后保存 pgt 头与 分区表的备份.

        <li>GPT 有校验机制, 会在磁盘头部的信息有误的情况下使用尾部的备份进行恢复.

        <li>ATS 对于裸盘的使用是会留下前后分别 8K 与 8M 的空间的.

        <li>ATS 会在磁盘 8K 的位置记录一些信息, 包含有磁盘大小, magic, free, used 之类的信息.

        <li>ATS 使用磁盘的时候会对于 magic 还有记录的磁盘大小信息进行检查, 如果信息没有这些信息或信息不对, 就认为
这个磁盘是没有使用过的, 如果有就认为磁盘是已经使用过的, 有数据. 也就是说, ATS 依赖于 magic number 判断磁盘是
不是有缓存数据在.
    </ul></p>

<p>基于以上的原因, 当给 ATS 使用的磁盘是一个使用 GPT 进行分区过的磁盘, 那么就会出现问题.</p>

<p>当 ATS 启动的时候, 会在 GPT 的分区表里写入 magic number, 这个时候分区表被破坏了, 当机器重新启动的时候,
发现分区表坏了, 使用尾部的信息恢复, 因为 ATS 不会影响到尾部的 备份信息, 所以备份的 分区表是 OK 的,
可以成功恢复. 完成恢复的过程中又把 ATS 的 magic number 清除了, ATS 启动的时候认为磁盘上没有数据, 清空磁盘.
结果是机器重启, ATS 输出类似 "disk header different for disk /dev/sda: clearing the disk" 的信息, 命中率降到 0.</p>
